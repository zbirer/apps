<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RSS Feed Reader</title>
    <style>
        /* Basic styles for the page */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            direction: rtl;
            text-align: right;
            -webkit-text-size-adjust: 100%; /* Prevent Chrome from adjusting text size */
            text-size-adjust: 100%;
        }

        /* Container for the RSS feed */
        .rss-feed {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        /* Styles for the controls (dropdowns and buttons) */
        .controls {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Styles for each RSS item */
        .rss-item {
            margin-bottom: 20px;
        }

        /* Styles for the title of each RSS item */
        .rss-item h2 {
            font-size: 20px;
            margin-bottom: 5px;
            color: #333;
            display: inline-block;
        }

        /* Styles for the description of each RSS item */
        .rss-item p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
        }

        /* Styles for the date of each RSS item */
        .rss-item .date {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }

        /* Styles for links */
        a {
            text-decoration: none;
            color: #0066cc;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Styles for images within the RSS items */
        img {
            max-width: 100%;
            height: auto;
            margin-top: 10px;
        }

        /* Styles for the Table of Contents (TOC) */
        .toc {
            font-size: 1rem; /* Set to rem for consistency */
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .toc a {
            display: block;
            margin-bottom: 5px;
            font-size: 1rem !important; /* Force consistent font size */
            color: #0066cc;
        }

        /* Styles for "Back to Top" and "Next Post" buttons */
        .back-to-top, .next-post {
            display: inline-block;
            font-size: 14px;
            color: #0066cc;
            cursor: pointer;
            margin-right: 10px;
        }

        .next-post {
            margin-left: 10px;
        }

        /* Styles for the throbber (loading spinner) */
        #throbber {
            display: none;
            margin-top: 10px;
            text-align: center;
        }

        #throbber img {
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <div class="rss-feed">
        <!-- Controls for adjusting font size, image size, category selection, and refreshing the feed -->
        <div class="controls">
            <div>
                <label for="fontSize">גופן:</label>
                <select id="fontSize">
                    <option value="normal">רגיל</option>
                    <option value="big">גדול</option>
                    <option value="biggest">הכי גדול</option>
                </select>
            </div>
            <div>
                <label for="imageSize">תמונות:</label>
                <select id="imageSize">
                    <option value="hide">הסתר</option>
                    <option value="normal">רגיל</option>
                    <option value="medium">בינוני</option>
                    <option value="big">גדול</option>
                </select>
            </div>
            <div>
                <label for="categorySelect">קטגוריה:</label>
                <select id="categorySelect">
                    <option value="news">חדשות</option>
                    <option value="tech">טכנולוגיה</option>
                </select>
            </div>
            <div>
                <button id="refreshButton">רענן</button>
            </div>
        </div>

        <!-- Throbber (loading spinner) shown when fetching data -->
        <div id="throbber">
            <img src="https://i.imgur.com/4L7fj1m.gif" alt="Loading...">
        </div>

        <!-- Table of Contents (TOC) section -->
        <div class="toc" id="toc">
            <h2>תוכן עניינים</h2>
            <div id="tocContent"></div>
        </div>

        <!-- Container where RSS feed content will be displayed -->
        <div id="rssContent"></div>
    </div>

    <script>
        // Arrays of RSS feed URLs for news and tech categories
        const newsFeeds = [
            'https://rss.walla.co.il/feed/1?type=main',
            'https://www.maariv.co.il/Rss/RssChadashot',
            'https://rcs.mako.co.il/rss/31750a2610f26110VgnVCM1000005201000aRCRD.xml',
            'https://www.ynet.co.il/Integration/StoryRss2.xml'
        ];

        const techFeeds = [
            'https://www.askpavel.co.il/feed',
            'https://www.tgspot.co.il/feed/',
            'https://www.maariv.co.il/Rss/RssFeedsTechnologeya',
            'https://rss.walla.co.il/feed/4703',
            'https://rss.walla.co.il/feed/6?type=main',
            'https://www.themarker.com/srv/tm-technation',
            'https://www.ynet.co.il/Integration/StoryRss544.xml'
        ];

        // Function to fetch RSS feeds based on selected category
        async function fetchRSSFeeds() {
            showThrobber();

            const category = document.getElementById('categorySelect').value;
            const feeds = category === 'tech' ? techFeeds : newsFeeds;

            const feedPromises = feeds.map(feed => 
                fetch(`https://api.rss2json.com/v1/api.json?rss_url=${feed}`).then(response => response.json())
            );

            const feedResults = await Promise.all(feedPromises);

            let allItems = [];
            feedResults.forEach(feed => {
                allItems = allItems.concat(feed.items);
            });

            // Sort all items by publication date
            allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));

            displayRSSItems(allItems);
            hideThrobber();
        }

        // Function to display RSS items on the page
        function displayRSSItems(items) {
            const rssContent = document.getElementById('rssContent');
            const tocContent = document.getElementById('tocContent');

            // Clear previous content
            rssContent.innerHTML = '';
            tocContent.innerHTML = '';

            items.forEach((item, index) => {
                const pubDate = new Date(item.pubDate);
                const formattedDate = pubDate.toLocaleDateString('he-IL', { year: 'numeric', month: 'long', day: 'numeric' });
                const formattedTime = pubDate.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });

                // Add item to Table of Contents with timestamp
                const tocItem = document.createElement('a');
                tocItem.href = `#post-${index}`;
                tocItem.textContent = `${formattedTime} - ${item.title}`;
                tocContent.appendChild(tocItem);

                // Create RSS item element
                const itemElement = document.createElement('div');
                itemElement.classList.add('rss-item');
                itemElement.id = `post-${index}`;

                const title = document.createElement('h2');
                title.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a>`;
                itemElement.appendChild(title);

                // Add "Next Post" button
                if (index < items.length - 1) {
                    const nextPostButton = document.createElement('div');
                    nextPostButton.classList.add('next-post');
                    nextPostButton.textContent = 'הפוסט הבא';
                    nextPostButton.addEventListener('click', () => {
                        document.getElementById(`post-${index + 1}`).scrollIntoView();
                    });
                    itemElement.appendChild(nextPostButton);
                }

                const date = document.createElement('div');
                date.classList.add('date');
                date.textContent = `${formattedDate} ${formattedTime}`;
                itemElement.appendChild(date);

                const description = document.createElement('p');
                description.innerHTML = item.description; // Use innerHTML to render HTML content correctly
                itemElement.appendChild(description);

                // Add "Back to Top" button
                const backToTop = document.createElement('div');
                backToTop.classList.add('back-to-top');
                backToTop.textContent = 'חזור למעלה';
                backToTop.addEventListener('click', () => {
                    window.scrollTo(0, 0); // Jump instantly to the top of the page
                });
                itemElement.appendChild(backToTop);

                rssContent.appendChild(itemElement);
            });

            applySettings();
        }

        // Function to apply settings for font size and image size
        function applySettings() {
            const fontSize = document.getElementById('fontSize').value;
            const imageSize = document.getElementById('imageSize').value;
            const rssItems = document.querySelectorAll('.rss-item p');

            rssItems.forEach(item => {
                switch (fontSize) {
                    case 'big':
                        item.style.fontSize = '20px';
                        break;
                    case 'biggest':
                        item.style.fontSize = '24px';
                        break;
                    default:
                        item.style.fontSize = '16px';
                }

                const images = item.querySelectorAll('img');
                images.forEach(img => {
                    switch (imageSize) {
                        case 'medium':
                            img.style.width = '50%';
                            break;
                        case 'big':
                            img.style.width = '100%';
                            break;
                        case 'hide':
                            img.style.display = 'none';
                            break;
                        default:
                            img.style.width = '25%';
                    }
                    img.style.display = (imageSize === 'hide') ? 'none' : 'block';
                });
            });
        }

        // Function to show the throbber (loading spinner)
        function showThrobber() {
            document.getElementById('throbber').style.display = 'block';
        }

        // Function to hide the throbber (loading spinner)
        function hideThrobber() {
            document.getElementById('throbber').style.display = 'none';
        }

        // Event listeners for category change, refresh button, and other settings
        document.getElementById('categorySelect').addEventListener('change', fetchRSSFeeds);
        document.getElementById('refreshButton').addEventListener('click', fetchRSSFeeds);
        document.getElementById('fontSize').addEventListener('change', applySettings);
        document.getElementById('imageSize').addEventListener('change', applySettings);

        // Initial load of the RSS feeds
        fetchRSSFeeds();
    </script>
</body>
</html>
